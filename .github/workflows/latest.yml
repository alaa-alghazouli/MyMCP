name: Build MyMCP (Universal Fix)
on: workflow_dispatch

jobs:
  build:
    runs-on: macos-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Build App (Universal & Compatible)
        run: |
          # 1. FIX PATH: Go into the subfolder
          cd MyMCP
          
          # 2. FIX COMPATIBILITY: Force macOS 12.0 and Universal Architecture
          xcodebuild -scheme MyMCP \
            -configuration Release \
            -derivedDataPath build \
            MACOSX_DEPLOYMENT_TARGET=12.0 \
            ARCHS="x86_64 arm64" \
            ONLY_ACTIVE_ARCH=NO \
            CODE_SIGN_IDENTITY="" \
            CODE_SIGNING_REQUIRED=NO \
            CODE_SIGNING_ALLOWED=NO

      - name: Zip with Symlinks (Fixes "Damaged" Error)
        run: |
          # Go to the build output folder
          cd MyMCP/build/Build/Products/Release
          
          # 3. FIX PERMISSIONS: Zip it preserving system links
          zip -r -y MyMCP_Universal.zip MyMCP.app

      - name: Upload Result
        uses: actions/upload-artifact@v4
        with:
          name: MyMCP-Universal-App
          path: MyMCP/build/Build/Products/Release/MyMCP_Universal.zip
